# KubeEngine

<div align="center">
<img src="./static/logo.png" alt="KubeEngine Logo" width="150"/>

### æ„å»ºäºéº’éºŸä¹‹ä¸Šï¼Œä¸ºäº‘åŸç”Ÿæ—¶ä»£æ‰“é€ çš„åšå›ºåŸºçŸ³

[![License: Apache 2.0](https://github.com/kubengine/kubengine/blob/main/static/badge/License-Apache%202.0-blue.svg)](LICENSE)
[![Kylin OS](https://github.com/kubengine/kubengine/blob/main/static/badge/Base%20OS-Kylin%20Server%20V11-orange.svg)](http://www.kylinos.cn/)
[![Python 3.11](https://github.com/kubengine/kubengine/blob/main/static/badge/python-3.11-blue.svg)](https://www.python.org/)
[![FastAPI](https://github.com/kubengine/kubengine/blob/main/static/badge/FastAPI-0.121+-green.svg)](https://fastapi.tiangolo.com/)

</div>

---

**KubeEngine** æ˜¯ä¸€ä¸ªä¸º **Kylin Server V11** æ“ä½œç³»ç»Ÿæ·±åº¦ä¼˜åŒ–çš„ä¼ä¸šçº§å®¹å™¨äº‘å¹³å°ã€‚æˆ‘ä»¬è‡´åŠ›äºåœ¨å›½äº§åŒ–åŸºç¡€è½¯ç¡¬ä»¶ç”Ÿæ€ä¸­ï¼Œæä¾›ä¸€å¥—åŠŸèƒ½å®Œå¤‡ã€ç¨³å®šé«˜æ•ˆä¸”é«˜åº¦è‡ªåŠ¨åŒ–çš„ Kubernetes å‘è¡Œç‰ˆä¸ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚

## ç›®å½•

- [ç®€ä»‹](#-ç®€ä»‹)
- [æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
- [ç³»ç»Ÿæ¶æ„](#-ç³»ç»Ÿæ¶æ„)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
- [CLI å‘½ä»¤](#-cli-å‘½ä»¤)
- [å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)
- [API æ–‡æ¡£](#-api-æ–‡æ¡£)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [æŠ€æœ¯æ ˆ](#-æŠ€æœ¯æ ˆ)
- [è®¸å¯è¯](#-è®¸å¯è¯)

## ğŸ“– ç®€ä»‹

KubeEngine æ—¨åœ¨ç®€åŒ–åœ¨ Kylin OS ä¸Šæ„å»ºå’Œç®¡ç† Kubernetes é›†ç¾¤çš„å¤æ‚åº¦ã€‚é€šè¿‡é›†æˆä¸šç•Œé¢†å…ˆçš„å¼€æºå·¥å…·ä¸è‡ªç ”çš„è‡ªåŠ¨åŒ–è¿ç»´ä½“ç³»ï¼Œæˆ‘ä»¬ä¸ºç”¨æˆ·æä¾›ä»åŸºç¡€è®¾æ–½éƒ¨ç½²ã€åº”ç”¨åˆ†å‘åˆ°å¯è§†åŒ–ç®¡ç†çš„ä¸€ç«™å¼å®¹å™¨äº‘ä½“éªŒã€‚

**æ ¸å¿ƒå®šä½**ï¼šæ‰“é€ æœ€é€‚åˆ Kylin OS çš„ Kubernetes ç”Ÿæ€å¹³å°ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ”© è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸è¿ç»´
- **åŸºäº pyinfra**ï¼šå®ç°ä»è£¸æœºåˆ°å®Œæ•´ K8s é›†ç¾¤çš„å…¨è‡ªåŠ¨åŒ–ã€ä¸€é”®å¼éƒ¨ç½²
- **ç”Ÿäº§å°±ç»ªç»„ä»¶**ï¼šé¢„é›†æˆå¹¶è‡ªåŠ¨åŒ–å®‰è£…ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š
  - **Calico**ï¼šé«˜æ€§èƒ½å®¹å™¨ç½‘ç»œè§£å†³æ–¹æ¡ˆ
  - **MetalLB**ï¼šè£¸æœº Kubernetes çš„è´Ÿè½½å‡è¡¡å™¨å®ç°
  - **Longhorn**ï¼šäº‘åŸç”Ÿåˆ†å¸ƒå¼å—å­˜å‚¨
  - **Harbor**ï¼šä¼ä¸šçº§ Docker é•œåƒä»“åº“
  - **Kata Containers**ï¼šå®‰å…¨å®¹å™¨è¿è¡Œæ—¶
  - **Helm**ï¼šKubernetes åº”ç”¨åŒ…ç®¡ç†å™¨
  - **Dashboard**ï¼šKubernetes é€šç”¨ Web UI
  - **Metrics Server**ï¼šé›†ç¾¤èµ„æºç›‘æ§
  - **Nginx Ingress**ï¼šKubernetes Ingress æ§åˆ¶å™¨

### ğŸ–¥ï¸ ç»Ÿä¸€å¯è§†åŒ–ç®¡æ§
- **è‡ªç ” Web UI**ï¼šæä¾›ç›´è§‚æ˜“ç”¨çš„å›¾å½¢åŒ–ç•Œé¢ï¼Œå‘Šåˆ«å¤æ‚çš„å‘½ä»¤è¡Œæ“ä½œ
- **å¼ºå¤§çš„ API å¼•æ“**ï¼šåŸºäº FastAPI æ„å»ºçš„é«˜æ€§èƒ½ RESTful API
- **WebSocket æ”¯æŒ**ï¼šå®æ—¶ä»»åŠ¡æ—¥å¿—è¾“å‡ºä¸çŠ¶æ€æ›´æ–°
- **å¹³å°ç®¡ç†**ï¼šé›†ç¾¤ã€èŠ‚ç‚¹ã€åº”ç”¨ã€èµ„æºçš„ç»Ÿä¸€çº³ç®¡ä¸ç›‘æ§

### ğŸ“¦ é«˜æ•ˆåº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **åº”ç”¨æ¨¡æ¿ä¸­å¿ƒ**ï¼šå†…ç½®ç»è¿‡æŠ½è±¡çš„é€šç”¨åº”ç”¨æ¨¡æ¿ï¼ˆå¦‚ Redisï¼‰
- **ä¸€é”®éƒ¨ç½²**ï¼šæ”¯æŒé€šè¿‡ Helm Chart å¿«é€Ÿéƒ¨ç½²å„ç±»ä¸­é—´ä»¶ä¸åº”ç”¨
- **é•œåƒå·¥å‚**ï¼šéµå¾ª OCI æ ‡å‡†çš„è‡ªåŠ¨åŒ–é•œåƒæ„å»ºç³»ç»Ÿ
- **é›†ç¾¤ç®¡ç†**ï¼šå¤šé›†ç¾¤æ”¯æŒï¼Œç»Ÿä¸€çš„é›†ç¾¤çº³ç®¡ä¸æ“ä½œ

### ğŸ” å®‰å…¨ä¸è®¤è¯
- **JWT è®¤è¯**ï¼šåŸºäºä»¤ç‰Œçš„å®‰å…¨è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ Token åˆ·æ–°
- **AK/SK å¯†é’¥å¯¹**ï¼šAPI è®¿é—®å¯†é’¥ç®¡ç†
- **TLS è¯ä¹¦ç®¡ç†**ï¼šè‡ªåŠ¨åŒ– CA è¯ä¹¦ç”Ÿæˆä¸ç®¡ç†
- **SSH ä¿¡ä»»é…ç½®**ï¼šé›†ç¾¤èŠ‚ç‚¹é—´ SSH å…å¯†äº’ä¿¡é…ç½®

### ğŸ‡¨ğŸ‡³ å›½äº§åŒ–ç”Ÿæ€æ”¯æŒ
- å½“å‰é¦–å‘é€‚é… **x86_64** æ¶æ„çš„ Kylin Server V11
- è·¯çº¿å›¾ä¸­è§„åˆ’å¯¹ **ARM64** æ¶æ„çš„é€‚é…

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         KubeEngine å¹³å°                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Web UI    â”‚  â”‚  CLI å·¥å…·   â”‚  â”‚    RESTful API          â”‚  â”‚
â”‚  â”‚   (å‰ç«¯)    â”‚  â”‚  (å‘½ä»¤è¡Œ)   â”‚  â”‚    (FastAPI)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                â”‚                     â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    æ ¸å¿ƒå¼•æ“å±‚                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ ä»»åŠ¡è°ƒåº¦ â”‚  â”‚ SSH ç®¡ç† â”‚  â”‚ é…ç½®ç®¡ç† â”‚  â”‚ é•œåƒæ„å»º    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ åº”ç”¨ç®¡ç† â”‚  â”‚ ORM å­˜å‚¨ â”‚  â”‚ HTTPå®¢æˆ·ç«¯â”‚ â”‚ WebSocket   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Kubernetes é›†ç¾¤                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Master  â”‚  â”‚  Worker  â”‚  â”‚   Calico â”‚  â”‚ Longhornâ”‚  â”‚  â”‚
â”‚  â”‚  â”‚  èŠ‚ç‚¹    â”‚  â”‚  èŠ‚ç‚¹    â”‚  â”‚   ç½‘ç»œ   â”‚  â”‚  å­˜å‚¨   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Harbor  â”‚  â”‚ MetalLB  â”‚  â”‚ Dashboardâ”‚  â”‚  Helm   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  é•œåƒä»“åº“â”‚  â”‚ è´Ÿè½½å‡è¡¡ â”‚  â”‚  Web UI  â”‚  â”‚  åŒ…ç®¡ç† â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šKylin Server V11 (x86_64)
- **Python**ï¼š3.11+
- **å†…å­˜**ï¼šè‡³å°‘ 8GB RAM
- **ç£ç›˜**ï¼šè‡³å°‘ 50GB å¯ç”¨ç©ºé—´

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-org/kubengine.git
cd kubengine

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -e .
```

### é…ç½®

ç¼–è¾‘ `/opt/kubengine/config/application.yaml`ï¼š

```yaml
root_dir: /opt/kubengine
domain: kubengine.io

# é›†ç¾¤èŠ‚ç‚¹é…ç½®
cluster:
  nodes:
    - 172.31.57.23
    - 172.31.57.22
    - 172.31.57.21
  hostnames:
    172.31.57.23: kubengine3
    172.31.57.22: kubengine2
    172.31.57.21: kubengine1

# Kubernetes é…ç½®
kubernetes:
  master:
    ip: 172.31.57.23
    schedulable: True
  worker:
    ips:
      - 172.31.57.22
      - 172.31.57.21
  cidr:
    pod: 10.96.0.0/16
    service: 10.97.0.0/16
  loadbalancer:
    ip-pools:
      - 172.31.57.30-172.31.57.40
```

### åˆå§‹åŒ–æ•°æ®

```bash
# åˆå§‹åŒ–é»˜è®¤åº”ç”¨æ¨¡æ¿æ•°æ®
python -m src.cli.app init-data
```

### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨ API æœåŠ¡
python -m src.cli.app run --host 0.0.0.0 --port 8080
```

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®é¡¹

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `root_dir` | KubeEngine æ ¹ç›®å½• | `/opt/kubengine` |
| `domain` | å¹³å°åŸŸå | `kubengine.io` |
| `cluster.nodes` | é›†ç¾¤èŠ‚ç‚¹ IP åˆ—è¡¨ | `[]` |
| `cluster.hostnames` | èŠ‚ç‚¹ IP åˆ°ä¸»æœºåçš„æ˜ å°„ | `{}` |
| `kubernetes.master.ip` | Master èŠ‚ç‚¹ IP | - |
| `kubernetes.master.schedulable` | Master æ˜¯å¦å¯è°ƒåº¦ | `True` |
| `kubernetes.cidr.pod` | Pod CIDR | `10.96.0.0/16` |
| `kubernetes.cidr.service` | Service CIDR | `10.97.0.0/16` |
| `auth.token.expire_minutes` | Token è¿‡æœŸæ—¶é—´(åˆ†é’Ÿ) | `30` |
| `auth.token.renew_threshold_minutes` | Token åˆ·æ–°é˜ˆå€¼(åˆ†é’Ÿ) | `5` |

### TLS è¯ä¹¦é…ç½®

```yaml
tls:
  root_dir: /opt/kubengine/config/certs
  ca_country_code: CN
  ca_state_name: Beijing
  ca_organization_name: kubengine
  ca_valid_days: 3650
```

### ç®¡ç†å‘˜è´¦æˆ·é…ç½®

ç®¡ç†å‘˜å¯†ç å’Œ AK/SK å¯†é’¥å¯¹é€šè¿‡ CLI è®¾ç½®ï¼š

```bash
# è®¾ç½®ç®¡ç†å‘˜å¯†ç ï¼ˆé¦–æ¬¡è®¾ç½®ä¼šè‡ªåŠ¨ç”Ÿæˆ AK/SKï¼‰
python -m src.cli.app set-password
```

## ğŸ› ï¸ CLI å‘½ä»¤

### åº”ç”¨ç®¡ç†

```bash
# å¯åŠ¨ API æœåŠ¡
python -m src.cli.app run [OPTIONS]

# é€‰é¡¹:
#   --host TEXT      ç›‘å¬çš„ä¸»æœºåœ°å€ (é»˜è®¤: 0.0.0.0)
#   --port INTEGER   ç›‘å¬çš„ç«¯å£å· (é»˜è®¤: 8080)
#   --workers INTEGER å·¥ä½œè¿›ç¨‹æ•° (é»˜è®¤: 1)

# è®¾ç½®ç®¡ç†å‘˜å¯†ç 
python -m src.cli.app set-password

# åˆå§‹åŒ–é»˜è®¤åº”ç”¨æ•°æ®
python -m src.cli.app init-data [OPTIONS]

# é€‰é¡¹:
#   --force    å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨çš„åº”ç”¨æ•°æ®
```

### é›†ç¾¤ç®¡ç†

```bash
# é…ç½®é›†ç¾¤ï¼ˆä¸»æœºå + SSH äº’ä¿¡ï¼‰
python -m src.cli.cluster configure-cluster [OPTIONS]

# é€‰é¡¹:
#   --hosts TEXT         é›†ç¾¤èŠ‚ç‚¹ IP åˆ—è¡¨ï¼Œé€—å·åˆ†éš”
#   --hostname-map TEXT  IP:ä¸»æœºå æ˜ å°„ï¼Œé€—å·åˆ†éš”
#   --username TEXT      SSH ç”¨æˆ·å (é»˜è®¤: root)
#   --password TEXT      SSH å¯†ç 
#   --key-file TEXT      SSH ç§é’¥æ–‡ä»¶è·¯å¾„ (é»˜è®¤: ~/.ssh/id_rsa)
#   --skip-verify        è·³è¿‡ SSH äº’ä¿¡éªŒè¯

# æ˜¾ç¤ºé›†ç¾¤é…ç½®
python -m src.cli.cluster show-cluster-config

# åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤
python -m src.cli.cluster execute-cmd [OPTIONS]

# é€‰é¡¹:
#   --hosts TEXT   èŠ‚ç‚¹ IP åˆ—è¡¨
#   --cmd TEXT     è¦æ‰§è¡Œçš„å‘½ä»¤ (å¿…éœ€)
#   --username TEXT SSH ç”¨æˆ·å
#   --password TEXT SSH å¯†ç 
#   --key-file TEXT SSH ç§é’¥æ–‡ä»¶è·¯å¾„

# ç¦ç”¨é˜²ç«å¢™
python -m src.cli.cluster disable-firewalld [OPTIONS]
```

### é•œåƒæ„å»º

```bash
# æ„å»ºå•ä¸ªåº”ç”¨ç‰ˆæœ¬
python -m src.cli.image build [OPTIONS]

# é€‰é¡¹:
#   --app TEXT         åº”ç”¨åç§° (å¿…éœ€)
#   --version TEXT     ç‰ˆæœ¬å·
#   --push             æ„å»ºåæ¨é€é•œåƒ
#   --registry TEXT    ç›®æ ‡ä»“åº“åœ°å€

# æ„å»ºå¤šä¸ªç‰ˆæœ¬
python -m src.cli.image build-multi [OPTIONS]

# æ„å»ºæ‰€æœ‰ç‰ˆæœ¬
python -m src.cli.image build-all [OPTIONS]

# åˆ—å‡ºæ”¯æŒçš„åº”ç”¨
python -m src.cli.image list-apps

# æ˜¾ç¤ºåº”ç”¨ä¿¡æ¯
python -m src.cli.image info [OPTIONS]

# æ¸…ç†æ„å»ºäº§ç‰©
python -m src.cli.image clean [OPTIONS]
```

### Kubernetes éƒ¨ç½²

```bash
# éƒ¨ç½² Kubernetes é›†ç¾¤
python -m src.cli.k8s deploy [OPTIONS]

# é€‰é¡¹:
#   --skip-dependencies  è·³è¿‡ä¾èµ–æ£€æŸ¥
#   --dry-run            ä»…æ˜¾ç¤ºå°†è¦æ‰§è¡Œçš„æ“ä½œ

# æ˜¾ç¤ºéƒ¨ç½²é…ç½®
python -m src.cli.k8s config [OPTIONS]

# é‡ç½®éƒ¨ç½²çŠ¶æ€
python -m src.cli.k8s reset-state
```

### é•œåƒä»“åº“æ“ä½œ

```bash
# æ‹‰å–é•œåƒ
python -m src.cli.image ctr pull [OPTIONS]

# æ¨é€é•œåƒ
python -m src.cli.image ctr push [OPTIONS]

# æ·»åŠ ä»“åº“ä»£ç†
python -m src.cli.image ctr add-proxy [OPTIONS]

# åˆ—å‡ºä»£ç†é…ç½®
python -m src.cli.image ctr list-proxy
```

## ğŸ‘¨â€ğŸ’» å¼€å‘æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"

# è¿è¡Œæµ‹è¯•
pytest

# ä»£ç æ ¼å¼åŒ–
black src/
isort src/

# ç±»å‹æ£€æŸ¥
mypy src/
```

### ä»£ç é£æ ¼

é¡¹ç›®éµå¾ªä»¥ä¸‹ä»£ç è§„èŒƒï¼š
- ä½¿ç”¨ Python 3.10+ ç±»å‹æ³¨è§£ï¼ˆ`str | None` è€Œé `Optional[str]`ï¼‰
- Google é£æ ¼çš„æ–‡æ¡£å­—ç¬¦ä¸²
- æ¨¡å—çº§åˆ†ç»„æ³¨é‡Šï¼ˆ`# ============================ æ ‡é¢˜ ============================`ï¼‰
- ä½¿ç”¨ `logger` è€Œé `print` è¿›è¡Œæ—¥å¿—è¾“å‡º

## ğŸ“š API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åè®¿é—®ï¼š

- **Swagger UI**ï¼š`http://localhost:8080/docs`
- **ReDoc**ï¼š`http://localhost:8080/redoc`

### ä¸»è¦ API ç«¯ç‚¹

#### è®¤è¯ (`/api/v1/auth`)
| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/login` | POST | ç”¨æˆ·ç™»å½•ï¼Œè¿”å› JWT Token |
| `/renew` | POST | åˆ·æ–°è®¿é—®ä»¤ç‰Œ |

#### å¥åº·æ£€æŸ¥ (`/api/v1/health`)
| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/` | GET | ç³»ç»Ÿå¥åº·çŠ¶æ€æ£€æŸ¥ |

#### SSH ç®¡ç† (`/api/v1/ssh`)
| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/execute` | POST | åœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œå‘½ä»¤ |

#### Kubernetes ç®¡ç† (`/api/v1/k8s`)
| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/node` | GET | è·å–èŠ‚ç‚¹ä¿¡æ¯ |
| `/overview` | GET | è·å–é›†ç¾¤æ¦‚è§ˆï¼ˆå« CPU/å†…å­˜æŒ‡æ ‡ï¼‰ |
| `/dashboard/resource/{type}` | GET | åˆ—å‡º K8s èµ„æºï¼ˆPodã€Service ç­‰ï¼‰ |
| `/dashboard/resourcedetail/{type}/{namespace}/{name}` | GET | è·å–èµ„æºè¯¦æƒ… |
| `/dashboard/resourcepod/{type}/{namespace}/{name}` | GET | è·å–èµ„æºå…³è”çš„ Pod |
| `/node/{name}/taints` | GET/POST/DELETE | èŠ‚ç‚¹æ±¡ç‚¹ç®¡ç† |

#### åº”ç”¨ç®¡ç† (`/api/v1/app`)
| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/list` | GET | åˆ†é¡µåˆ—å‡ºåº”ç”¨ |
| `/get/{app_id}` | GET | æ ¹æ® ID è·å–åº”ç”¨è¯¦æƒ… |
| `/add` | POST | åˆ›å»ºæ–°åº”ç”¨ |
| `/update` | PUT | æ›´æ–°åº”ç”¨ |
| `/del/{app_id}` | DELETE | åˆ é™¤åº”ç”¨ |
| `/deploy` | POST | éƒ¨ç½²åº”ç”¨ |
| `/cluster` | GET | åˆ—å‡ºæ‰€æœ‰é›†ç¾¤ |
| `/cluster/{cluster_id}` | GET | è·å–é›†ç¾¤è¯¦æƒ… |
| `/clusterInfo/{cluster_id}` | GET | è·å–é›†ç¾¤èµ„æºè¯¦æƒ… |
| `/cluster/{cluster_id}/name` | PUT | æ›´æ–°é›†ç¾¤åç§° |
| `/cluster/{cluster_ip}` | DELETE | åˆ é™¤é›†ç¾¤ |

#### åˆ¶å“ç®¡ç† (`/api/v1/artifacts`)
| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/list` | GET | åˆ—å‡ºåˆ¶å“æ–‡ä»¶ |
| `/upload` | POST | ä¸Šä¼ åˆ¶å“æ–‡ä»¶ |
| `/download/{filename}` | GET | ä¸‹è½½åˆ¶å“æ–‡ä»¶ |
| `/delete/{filename}` | DELETE | åˆ é™¤åˆ¶å“æ–‡ä»¶ |

#### WebSocket (`/api/v1/ws`)
| ç«¯ç‚¹ | æè¿° |
|------|------|
| `/logs` | å®æ—¶ä»»åŠ¡æ—¥å¿—æµ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
kubengine/
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ application.yaml       # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ certs/                 # TLS è¯ä¹¦ç›®å½•
â”‚       â”œâ”€â”€ ca/                # CA è¯ä¹¦
â”‚       â””â”€â”€ server/            # æœåŠ¡å™¨è¯ä¹¦
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                   # RESTful API å®ç°ï¼ˆåºŸå¼ƒï¼Œç§»è‡³ web/apiï¼‰
â”‚   â”œâ”€â”€ builder/               # é•œåƒæ„å»ºæ¨¡å—
â”‚   â”‚   â””â”€â”€ image/
â”‚   â”‚       â”œâ”€â”€ base_builder.py      # åŸºç¡€æ„å»ºå™¨ç±»
â”‚   â”‚       â”œâ”€â”€ loader.py            # æ„å»ºå™¨åŠ è½½å™¨
â”‚   â”‚       â”œâ”€â”€ os/                  # æ“ä½œç³»ç»Ÿé•œåƒæ„å»ºå™¨
â”‚   â”‚       â”‚   â””â”€â”€ kylin_v11.py     # Kylin OS æ„å»ºå™¨
â”‚   â”‚       â”œâ”€â”€ kubectl/             # kubectl é•œåƒ
â”‚   â”‚       â”œâ”€â”€ redis/               # Redis é•œåƒ
â”‚   â”‚       â””â”€â”€ rootfs/              # æ ¹æ–‡ä»¶ç³»ç»Ÿæ„å»ºå™¨
â”‚   â”œâ”€â”€ cli/                   # å‘½ä»¤è¡Œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ app.py             # åº”ç”¨ç®¡ç†å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ cluster.py         # é›†ç¾¤ç®¡ç†å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ image.py           # é•œåƒæ„å»ºå‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ k8s.py             # K8s éƒ¨ç½²å‘½ä»¤
â”‚   â”‚   â””â”€â”€ models.py          # CLI æ¨¡å‹
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ application.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config_dict.py
â”‚   â”‚   â”‚   â””â”€â”€ inject.py
â”‚   â”‚   â”œâ”€â”€ containerd/        # Container è¿è¡Œæ—¶
â”‚   â”‚   â”œâ”€â”€ http_api_client/   # HTTP API å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ basic_client.py
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard_client.py
â”‚   â”‚   â”‚   â”œâ”€â”€ harbor_client.py
â”‚   â”‚   â”‚   â”œâ”€â”€ helm_resource_check.py
â”‚   â”‚   â”‚   â”œâ”€â”€ k8s_client.py
â”‚   â”‚   â”‚   â””â”€â”€ longhorn_client.py
â”‚   â”‚   â”œâ”€â”€ misc/              # å·¥å…·æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ ca.py
â”‚   â”‚   â”‚   â”œâ”€â”€ network.py
â”‚   â”‚   â”‚   â”œâ”€â”€ password.py
â”‚   â”‚   â”‚   â”œâ”€â”€ properties.py
â”‚   â”‚   â”‚   â”œâ”€â”€ time.py
â”‚   â”‚   â”‚   â””â”€â”€ websocket.py
â”‚   â”‚   â”œâ”€â”€ orm/               # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ app.py
â”‚   â”‚   â”‚   â”œâ”€â”€ app_field_config.py
â”‚   â”‚   â”‚   â”œâ”€â”€ cluster.py
â”‚   â”‚   â”‚   â”œâ”€â”€ engine.py
â”‚   â”‚   â”‚   â””â”€â”€ task.py
â”‚   â”‚   â”œâ”€â”€ command.py         # å‘½ä»¤æ‰§è¡Œ
â”‚   â”‚   â”œâ”€â”€ logger.py          # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ ssh.py             # SSH å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ infra/                 # åŸºç¡€è®¾æ–½éƒ¨ç½²è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ install_calico.py          # Calico ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ install_containerd.py      # Container è¿è¡Œæ—¶
â”‚   â”‚   â”œâ”€â”€ install_cni.py             # CNI ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ install_dashboard.py       # K8s Dashboard
â”‚   â”‚   â”œâ”€â”€ install_harbor.py          # é•œåƒä»“åº“
â”‚   â”‚   â”œâ”€â”€ install_helm.py            # åŒ…ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ install_ingress_nginx.py   # Ingress æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ install_kubernetes.py      # K8s ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ install_longhorn.py        # åˆ†å¸ƒå¼å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ install_metallb.py         # è´Ÿè½½å‡è¡¡å™¨
â”‚   â”‚   â”œâ”€â”€ install_metrics_server.py   # æŒ‡æ ‡é‡‡é›†
â”‚   â”‚   â”œâ”€â”€ issue_cert.py              # è¯ä¹¦ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ kubernetes_join_node.py    # èŠ‚ç‚¹åŠ å…¥
â”‚   â”‚   â””â”€â”€ executor_wrapper.py        # è„šæœ¬æ‰§è¡Œå™¨
â”‚   â””â”€â”€ web/                   # Web ç•Œé¢
â”‚       â”œâ”€â”€ api/               # API ç«¯ç‚¹
â”‚       â”‚   â”œâ”€â”€ app.py         # åº”ç”¨ç®¡ç† API
â”‚       â”‚   â”œâ”€â”€ artifacts.py   # åˆ¶å“ç®¡ç† API
â”‚       â”‚   â”œâ”€â”€ auth_routes.py # è®¤è¯ API
â”‚       â”‚   â”œâ”€â”€ health.py      # å¥åº·æ£€æŸ¥ API
â”‚       â”‚   â”œâ”€â”€ k8s.py         # K8s ç®¡ç† API
â”‚       â”‚   â”œâ”€â”€ ssh.py         # SSH ç®¡ç† API
â”‚       â”‚   â””â”€â”€ websocket.py   # WebSocket API
â”‚       â”œâ”€â”€ main.py            # FastAPI åº”ç”¨å…¥å£
â”‚       â”œâ”€â”€ static/            # é™æ€æ–‡ä»¶
â”‚       â””â”€â”€ utils/             # Web å·¥å…·
â”‚           â”œâ”€â”€ auth.py        # è®¤è¯å·¥å…·
â”‚           â”œâ”€â”€ page.py        # åˆ†é¡µå·¥å…·
â”‚           â””â”€â”€ response.py    # å“åº”å·¥å…·
â”œâ”€â”€ static/                    # é™æ€èµ„æº
â”‚   â”œâ”€â”€ badge/                 # å¾½ç« å›¾ç‰‡
â”‚   â””â”€â”€ logo.png               # Logo å›¾ç‰‡
â”œâ”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ tests/                     # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ pyproject.toml             # é¡¹ç›®é…ç½®
â”œâ”€â”€ kubekylin.db               # SQLite æ•°æ®åº“
â””â”€â”€ README.md                  # é¡¹ç›®æ–‡æ¡£
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- **FastAPI** >= 0.121.3ï¼šç°ä»£åŒ–ã€é«˜æ€§èƒ½çš„ Web æ¡†æ¶
- **Uvicorn** >= 0.38.0ï¼šASGI æœåŠ¡å™¨
- **Pydantic** v2ï¼šæ•°æ®éªŒè¯ä¸è®¾ç½®ç®¡ç†
- **SQLAlchemy** >= 2.0.45ï¼šORM å·¥å…·
- **Click**ï¼šå‘½ä»¤è¡Œç•Œé¢æ¡†æ¶

### Kubernetes ç”Ÿæ€
- **kubernetes-python** >= 34.1.0ï¼šKubernetes Python å®¢æˆ·ç«¯
- **Helm**ï¼šKubernetes åŒ…ç®¡ç†å™¨
- **pyinfra** >= 3.5.1ï¼šè‡ªåŠ¨åŒ–åŸºç¡€è®¾æ–½éƒ¨ç½²
- **asyncssh** >= 2.21.1ï¼šå¼‚æ­¥ SSH å®¢æˆ·ç«¯

### Web ä¸é€šä¿¡
- **WebSockets** >= 15.0.1ï¼šå®æ—¶é€šä¿¡
- **python-multipart** >= 0.0.20ï¼šæ–‡ä»¶ä¸Šä¼ æ”¯æŒ
- **requests** >= 2.32.5ï¼šHTTP è¯·æ±‚åº“

### å¼€å‘å·¥å…·
- **pytest** >= 9.0.1ï¼šæµ‹è¯•æ¡†æ¶
- **black** >= 23.1.0ï¼šä»£ç æ ¼å¼åŒ–
- **mypy** >= 1.0.0ï¼šé™æ€ç±»å‹æ£€æŸ¥
- **isort** >= 5.12.0ï¼šå¯¼å…¥æ’åº
- **rich** >= 14.3.1ï¼šç¾åŒ–å‘½ä»¤è¡Œè¾“å‡º

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [Apache License 2.0](LICENSE) å¼€æºåè®®ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·æŸ¥çœ‹ [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£è¯¦æƒ…ã€‚

## ğŸ“® è”ç³»æ–¹å¼

- **ä½œè€…**ï¼šduanzt
- **é‚®ç®±**ï¼šduanziteng@gmail.com
- **é¡¹ç›®ä¸»é¡µ**ï¼šhttps://github.com/kubengine/kubengine
