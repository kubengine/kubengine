"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9155],{59485:function(se,D,e){var A=e(5574),h=e.n(A),T=e(57132),j=e(47221),v=e(2453),l=e(4393),c=e(83622),m=e(67294),C=e(37246),u=e(74346),d=e(85893),E=j.Z.Panel,P=function(g){var V=g.yamlText,U=g.title,Y=U===void 0?"YAML \u914D\u7F6E":U,L=g.hidden,G=L===void 0?!1:L,B=(0,m.useState)(!1),W=h()(B,2),M=W[0],R=W[1],S=V,Z=function(O){return navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(O):new Promise(function(p,n){var r=document.createElement("textarea");r.value=O,r.style.position="fixed",r.style.top="-9999px",r.style.left="-9999px",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select();try{var a=document.execCommand("copy");a?p():n(new Error("\u590D\u5236\u5931\u8D25"))}catch(J){n(J)}finally{document.body.removeChild(r)}})},F=function(){Z(S).then(function(){R(!0),setTimeout(function(){return R(!1)},2e3),v.ZP.success("\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(function(O){console.error("\u590D\u5236\u5931\u8D25:",O);var p=document.querySelector("pre");if(p){var n=document.createRange();n.selectNodeContents(p);var r=window.getSelection();r==null||r.removeAllRanges(),r==null||r.addRange(n)}v.ZP.error("\u81EA\u52A8\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u624B\u52A8\u590D\u5236\u5185\u5BB9")})};return(0,d.jsx)(l.Z,{title:(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Y,(0,d.jsx)(c.ZP,{type:"text",icon:(0,d.jsx)(T.Z,{}),disabled:M,onClick:F,children:M?"\u5DF2\u590D\u5236":"\u590D\u5236"})]}),hidden:G,style:{marginTop:16},children:(0,d.jsx)(j.Z,{defaultActiveKey:["1"],bordered:!1,children:(0,d.jsx)(E,{header:"\u67E5\u770B YAML \u5185\u5BB9",children:(0,d.jsx)(C.Z,{language:"yaml",style:u.Z,showLineNumbers:!0,lineNumberStyle:{color:"#ccc",fontSize:12},wrapLines:!0,children:S})},"1")})})};D.Z=P},82703:function(se,D,e){e.r(D);var A=e(97857),h=e.n(A),T=e(19632),j=e.n(T),v=e(15009),l=e.n(v),c=e(99289),m=e.n(c),C=e(5574),u=e.n(C),d=e(59485),E=e(62832),P=e(80771),K=e(99611),g=e(86548),V=e(48689),U=e(68795),Y=e(90930),L=e(88026),G=e(25593),B=e(86587),W=e(98081),M=e(83622),R=e(17788),S=e(86738),Z=e(2453),F=e(25278),H=e(74330),O=e(61182),p=e(32983),n=e(67294),r=e(14873),a=e(85893),J=G.Z.Text,Ee=function(y){var b=y.status,Q=function(){switch(b){case"pending":return{colorClass:"status-dot dot-success blink-animation",text:"\u5F85\u521B\u5EFA"};case"creating":return{colorClass:"status-dot dot-success blink-animation",text:"\u521B\u5EFA\u4E2D"};case"checking":return{colorClass:"status-dot dot-warning blink-animation",text:"\u72B6\u6001\u68C0\u67E5\u4E2D"};case"cleaning":return{colorClass:"status-dot dot-warning blink-animation",text:"\u8D44\u6E90\u6E05\u7406\u4E2D"};case"healthy":return{colorClass:"status-dot dot-success",text:"\u5065\u5EB7"};case"unhealthy":return{colorClass:"status-dot dot-warning",text:"\u4E0D\u5065\u5EB7"};case"anomaly":return{colorClass:"status-dot dot-error",text:"\u5F02\u5E38"};default:return{colorClass:"status-dot dot-default",text:"\u672A\u77E5"}}},$=Q();return(0,a.jsxs)(J,{children:[(0,a.jsx)("span",{className:$.colorClass}),$.text]})},he=function(){var y=(0,L.useModel)("websocket"),b=y.messages,Q=y.connect,$=y.clearMessages,ne=y.close,fe=(0,n.useState)(""),re=u()(fe,2),X=re[0],De=re[1],Ce=(0,n.useState)(!1),_e=u()(Ce,2),Pe=_e[0],z=_e[1],Me=(0,n.useState)(!1),le=u()(Me,2),Oe=le[0],w=le[1],pe=(0,n.useState)(!1),ue=u()(pe,2),ye=ue[0],k=ue[1],xe=(0,n.useState)([]),oe=u()(xe,2),q=oe[0],de=oe[1],Ae=(0,n.useState)(),ie=u()(Ae,2),ee=ie[0],Te=ie[1],je=B.Z.useForm(),ge=u()(je,1),te=ge[0],Le=(0,n.useState)({current:1,pageSize:10}),ce=u()(Le,2),N=ce[0],Be=ce[1],Re=(0,n.useState)(0),me=u()(Re,2),be=me[0],Ie=me[1],Ke=function(s,t){Be({current:s,pageSize:t})},Ue=function(){var _=m()(l()().mark(function s(t){return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return z(!0),o.next=3,E.Z.AppsController.del_cluster(t);case 3:z(!1);case 4:case"end":return o.stop()}},s)}));return function(t){return _.apply(this,arguments)}}(),We=[{title:"\u96C6\u7FA4ID",dataIndex:"cluster_id",key:"cluster_id",width:100,render:function(s,t){return t.status!="healthy"?(0,a.jsx)("span",{children:s}):(0,a.jsx)(L.Link,{to:"/apps/cluster/detail/".concat(s),children:s})}},{title:"\u96C6\u7FA4\u540D\u79F0",dataIndex:"name",key:"name",width:100},{title:"helm chart\u6A21\u677F\u540D\u79F0",dataIndex:"helm_chart",key:"helm_chart",width:100},{title:"helm chart\u6A21\u677F\u7248\u672C",dataIndex:"helm_chart_version",key:"helm_chart_version",width:100},{title:"\u521B\u5EFA\u4E8E",dataIndex:"create_time",key:"create_time",width:100,render:function(s){return(0,P.n)(s)}},{title:"\u72B6\u6001",dataIndex:"status",key:"status",width:100,render:function(s){return(0,a.jsx)(Ee,{status:s})}},{title:"\u64CD\u4F5C",key:"action",width:200,render:function(s,t){return(0,a.jsxs)(W.Z,{size:"middle",children:[(0,a.jsx)(M.ZP,{type:"text",icon:(0,a.jsx)(K.Z,{}),onClick:function(){R.Z.info({title:"".concat(t.name," Helm Values"),width:700,content:(0,a.jsx)(d.Z,{yamlText:(0,r.Pz)(t.helm_config),title:"values.yaml"})})},children:"Helm Values"}),(0,a.jsx)(M.ZP,{type:"text",icon:(0,a.jsx)(g.Z,{}),onClick:function(){Te(t),w(!0)},disabled:t.status!="healthy"&&t.status!="unhealthy"&&t.status!="anomaly",children:"\u4FEE\u6539\u540D\u79F0"}),(0,a.jsx)(S.Z,{title:"\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u96C6\u7FA4\u5417\uFF1F",onConfirm:function(){Ue(t.cluster_id)},okText:"\u662F",cancelText:"\u5426",children:(0,a.jsx)(M.ZP,{type:"text",danger:!0,icon:(0,a.jsx)(V.Z,{}),disabled:t.status!="healthy"&&t.status!="unhealthy"&&t.status!="anomaly",children:"\u5220\u9664"})})]})}}],Se=function(){var _=m()(l()().mark(function s(){var t,i,o,I;return l()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,te.validateFields();case 2:return t=f.sent,i=t.name.trim(),k(!0),f.next=7,E.Z.AppsController.update_cluster((ee==null?void 0:ee.cluster_id)||0,i);case 7:o=f.sent,I=o.code,I===200&&(Z.ZP.success("\u4FEE\u6539\u6210\u529F"),ae(),w(!1)),k(!1);case 11:case"end":return f.stop()}},s)}));return function(){return _.apply(this,arguments)}}(),ae=function(){var _=m()(l()().mark(function s(){var t,i,o;return l()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return z(!0),x.next=3,E.Z.AppsController.cluster_list(X,N.pageSize,N.current);case 3:t=x.sent,i=t.code,o=t.data,i==200?(de(o.data),Ie(o.total)):Z.ZP.error("\u83B7\u53D6\u5E94\u7528\u914D\u7F6E\u5217\u8868\u5931\u8D25"),z(!1);case 8:case"end":return x.stop()}},s)}));return function(){return _.apply(this,arguments)}}();return(0,n.useEffect)(function(){b.length>0&&(b.map(function(_){var s=_.type,t=_.data;if(s=="receive")if(t.action=="update_cluster"){var i=j()(q||[]),o=q.findIndex(function(I){return I.cluster_id==t.data.cluster_id});o!==-1&&(i[o]=t.data),de(i)}else t.action=="refresh_clusters"&&ae()}),$())},[b]),(0,n.useEffect)(function(){Q()},[]),(0,n.useEffect)(function(){return function(){ne()}},[]),(0,n.useEffect)(function(){ae()},[X,N]),(0,a.jsxs)(Y._z,{children:[(0,a.jsx)("div",{style:{marginBottom:16,display:"flex",gap:8},children:(0,a.jsx)(F.Z,{placeholder:"\u641C\u7D22\u96C6\u7FA4\u540D\u79F0",prefix:(0,a.jsx)(U.Z,{}),value:X,onChange:function(s){return De(s.target.value)},style:{width:300}})}),(0,a.jsx)(H.Z,{spinning:Pe,children:(0,a.jsx)(O.Z,{dataSource:q,columns:We,rowKey:"id",pagination:h()(h()({},N),{},{showSizeChanger:!0,total:be,onChange:Ke}),scroll:{x:1100},locale:{emptyText:(0,a.jsx)(p.Z,{description:"\u6682\u65E0\u96C6\u7FA4"})}})}),(0,a.jsx)(R.Z,{title:"\u4FEE\u6539\u96C6\u7FA4\u540D\u79F0",open:Oe,onOk:Se,onCancel:function(){w(!1),k(!1)},afterClose:function(){te.resetFields()},confirmLoading:ye,destroyOnHidden:!0,maskClosable:!1,width:400,children:(0,a.jsx)(B.Z,{form:te,layout:"horizontal",initialValues:{name:""},children:(0,a.jsx)(B.Z.Item,{name:"name",label:"\u65B0\u7684\u96C6\u7FA4\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u7684\u96C6\u7FA4\u540D"}],children:(0,a.jsx)(F.Z,{placeholder:"\u8BF7\u8F93\u5165\u65B0\u7684\u96C6\u7FA4\u540D"})})})})]})};D.default=he},80771:function(se,D,e){e.d(D,{n:function(){return T}});var A=e(27484),h=e.n(A),T=function(v){if(!v)return"";try{var l=h()(v),c=h()(),m=c.diff(l,"second"),C=c.diff(l,"minute"),u=c.diff(l,"hour"),d=c.diff(l,"day"),E=c.diff(l,"month"),P=c.diff(l,"year");return P>0?"".concat(P,"\u5E74\u524D"):E>0?"".concat(E,"\u4E2A\u6708\u524D"):d>0?"".concat(d,"\u5929\u524D"):u>0?"".concat(u,"\u5C0F\u65F6\u524D"):C>0?"".concat(C,"\u5206\u949F\u524D"):m>30?"".concat(m,"\u79D2\u524D"):"\u521A\u521A"}catch(K){return console.error("\u76F8\u5BF9\u65F6\u95F4\u8BA1\u7B97\u9519\u8BEF:",K),""}}}}]);
