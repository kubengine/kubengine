"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6609],{52802:function(Qe,ge,t){t.r(ge),t.d(ge,{default:function(){return st}});var be=t(97857),n=t.n(be),Ee=t(19632),M=t.n(Ee),fe=t(15009),U=t.n(fe),Ze=t(99289),te=t.n(Ze),Se=t(5574),F=t.n(Se),ne=t(62832),$=t(35681),ie=t(24969),Be=t(60219),Ae=t(90930),Ce=t(88026),j=t(86587),W=t(2453),De=t(4393),ue=t(92398),w=t(83622),u=t(67294),pe=t(65136),Pe=t(9783),me=t.n(Pe),r=t(52745),se=t(34041),Oe=t(17788),N=t(25278),Fe=t(72269),xe=t(13457),e=t(85893),Te=se.Z.Option,Ie=[{label:"\u6587\u672C\u8F93\u5165",value:"text"},{label:"\u5BC6\u7801\u8F93\u5165",value:"password"},{label:"\u6570\u5B57\u8F93\u5165",value:"number"},{label:"\u4E0B\u62C9\u9009\u62E9",value:"select"},{label:"\u5355\u9009\u6846\u7EC4",value:"radio"},{label:"\u5F00\u5173",value:"switch"}],Me=[{label:"\u5B57\u7B26\u4E32",value:"string"},{label:"\u6570\u5B57",value:"number"},{label:"\u90AE\u7BB1",value:"email"},{label:"\u7F51\u5740",value:"url"}],Je=[{label:"\u5931\u53BB\u7126\u70B9",value:"blur"},{label:"\u503C\u53D8\u5316",value:"change"},{label:"\u5931\u53BB\u7126\u70B9+\u503C\u53D8\u5316",value:"blur,change"}],we=function(v){var d=v.init_field,L=v.visible,R=v.onCancel,K=v.onSave,V=v.nameValidator,S=j.Z.useForm(),z=F()(S,1),Z=z[0],X=(0,u.useState)([]),Y=F()(X,2),O=Y[0],b=Y[1],T=(0,u.useState)([]),y=F()(T,2),c=y[0],D=y[1],he=(0,u.useState)(d),k=F()(he,2),f=k[0],Q=k[1];(0,u.useEffect)(function(){Q(function(l){return n()(n()({},l),{},{field_props:n()(n()({},l.field_props),{},{options:O})})})},[O]),(0,u.useEffect)(function(){Q(function(l){return n()(n()({},l),{},{rules:c})})},[c]),(0,u.useEffect)(function(){Q(d),b(d.field_props.options||[]),D(d.rules),Z.setFieldsValue(d)},[d]);var ve=function(){b(function(a){return[].concat(M()(a),[{label:"",value:""}])})},oe=function(a){var i=M()(O);i.splice(a,1),b(i)},de=function(a,i,h){var g=M()(O);g[a]=n()(n()({},g[a]),{},me()({},i,h)),b(g)},ce=function(){D(function(a){return[].concat(M()(a),[{type:"string",message:""}])})},H=function(a){var i=M()(c);i.splice(a,1),D(i)},p=function(a,i,h){var g=M()(c);g[a]=n()(n()({},g[a]),{},me()({},i,h)),D(g)},m=function(){Z.validateFields().then(function(a){if(f.type==="select"||f.type==="radio")if(f.field_props.options==null)W.ZP.error("\u8BF7\u5B8C\u5584\u6240\u6709\u9009\u9879\u7684\u6807\u7B7E\u548C\u503C");else{var i=f.field_props.options.find(function(g){return!g.label||!g.value});if(i){W.ZP.error("\u8BF7\u5B8C\u5584\u6240\u6709\u9009\u9879\u7684\u6807\u7B7E\u548C\u503C");return}}var h=n()(n()(n()({},f),a),{},{rules:c,initial_value:a.initial_value,field_props:n()(n()({},a.field_props),{},{options:O})});K(h),R()}).catch(function(a){console.error("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25:",a),W.ZP.error("\u8BF7\u5B8C\u5584\u5FC5\u586B\u9879\u914D\u7F6E")})},G=function(a){var i=Z.getFieldsValue();Q(n()(n()({},i),{},{type:a}))};return(0,e.jsx)(Oe.Z,{title:"\u5B57\u6BB5\u914D\u7F6E",open:L,onCancel:R,onOk:m,destroyOnHidden:!1,afterClose:function(){Q((0,$.get_init_field_config)()),Z.resetFields(),b([]),D([])},afterOpenChange:function(a){a||(Q((0,$.get_init_field_config)()),Z.resetFields(),b([]),D([]))},width:800,children:(0,e.jsxs)(j.Z,{form:Z,layout:"vertical",validateMessages:{required:"${label}\u4E3A\u5FC5\u586B\u9879"},children:[(0,e.jsxs)("div",{style:{marginBottom:24,paddingBottom:16,borderBottom:"1px solid #f0f0f0"},children:[(0,e.jsx)("h4",{style:{margin:"0 0 16 0",fontSize:16},children:"\u57FA\u7840\u914D\u7F6E"}),(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,e.jsx)(j.Z.Item,{name:"name",label:"\u5B57\u6BB5\u540D (name)",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u540D"},{validator:function(a,i){return f!=null&&f.name!=""&&f.name!=null?Promise.resolve():V(a,i)}}],children:(0,e.jsx)(N.Z,{placeholder:"\u5982\uFF1Ausername\u3001phone\u3001age",disabled:f.name!=""&&f.name==d.name})}),(0,e.jsx)(j.Z.Item,{name:"label",label:"\u6807\u7B7E (label)",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u6807\u7B7E"}],children:(0,e.jsx)(N.Z,{placeholder:"\u5982\uFF1A\u7528\u6237\u540D\u3001\u624B\u673A\u53F7\u3001\u5E74\u9F84",disabled:f.label!=""&&f.label==d.label})}),(0,e.jsx)(j.Z.Item,{name:"extra",label:"\u989D\u5916\u7684\u63D0\u793A\u4FE1\u606F (extra)",tooltip:"\u989D\u5916\u7684\u63D0\u793A\u4FE1\u606F\uFF0C\u548C help \u7C7B\u4F3C\uFF0C\u5F53\u9700\u8981\u9519\u8BEF\u4FE1\u606F\u548C\u63D0\u793A\u6587\u6848\u540C\u65F6\u51FA\u73B0\u65F6\uFF0C\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2A\u3002",children:(0,e.jsx)(N.Z,{})}),(0,e.jsx)(j.Z.Item,{name:["form_item_props","required"],label:"\u662F\u5426\u5FC5\u586B",valuePropName:"checked",children:(0,e.jsx)(Fe.Z,{})}),(0,e.jsx)(j.Z.Item,{name:"type",label:"\u5B57\u6BB5\u7C7B\u578B (type)",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5B57\u6BB5\u7C7B\u578B"}],children:(0,e.jsx)(se.Z,{placeholder:"\u9009\u62E9\u5B57\u6BB5\u7C7B\u578B",onChange:G,showSearch:!0,optionFilterProp:"children",children:Ie.map(function(l){return(0,e.jsx)(Te,{value:l.value,children:l.label},l.value)})})}),(0,e.jsx)(j.Z.Item,{name:"initial_value",label:"\u9ED8\u8BA4\u503C (initialValue)",children:f.type==="number"?(0,e.jsx)(xe.Z,{style:{width:"100%"},placeholder:"\u6570\u5B57\u7C7B\u578B\u9ED8\u8BA4\u503C",precision:0}):f.type==="switch"?(0,e.jsx)(Fe.Z,{checkedChildren:"\u662F",unCheckedChildren:"\u5426"}):(0,e.jsx)(N.Z,{placeholder:"\u8BF7\u8F93\u5165".concat(f.label||"\u9ED8\u8BA4\u503C")})})]}),(f.type==="text"||f.type==="password")&&(0,e.jsx)(j.Z.Item,{name:["field_props","placeholder"],label:"\u5360\u4F4D\u63D0\u793A (placeholder)",style:{marginTop:16},children:(0,e.jsx)(N.Z,{placeholder:"\u8BF7\u8F93\u5165".concat(f.label||"\u5185\u5BB9")})}),(f.type==="text"||f.type==="password"||f.type==="select")&&(0,e.jsx)(j.Z.Item,{name:["field_props","allowClear"],label:"\u5141\u8BB8\u6E05\u7A7A",valuePropName:"checked",style:{marginTop:16},children:(0,e.jsx)(Fe.Z,{})})]}),(f.type==="select"||f.type==="radio")&&(0,e.jsxs)("div",{style:{marginBottom:24,paddingBottom:16,borderBottom:"1px solid #f0f0f0"},children:[(0,e.jsx)("h4",{style:{margin:"0 0 16 0",fontSize:16},children:"\u9009\u9879\u914D\u7F6E"}),(0,e.jsxs)("div",{children:[O.map(function(l,a){return(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:16},children:[(0,e.jsx)(N.Z,{placeholder:"\u9009\u9879\u6807\u7B7E",value:l.label,onChange:function(h){return de(a,"label",h.target.value)},style:{flex:1}}),(0,e.jsx)(N.Z,{placeholder:"\u9009\u9879\u503C",value:l.value,onChange:function(h){return de(a,"value",h.target.value)},style:{flex:1}}),(0,e.jsx)(w.ZP,{danger:!0,icon:(0,e.jsx)(r.Z,{}),onClick:function(){return oe(a)},disabled:O.length<=1})]},a)}),(0,e.jsx)(w.ZP,{type:"dashed",icon:(0,e.jsx)(ie.Z,{}),onClick:ve,style:{width:"100%"},children:"\u6DFB\u52A0\u9009\u9879"})]})]}),(0,e.jsxs)("div",{style:{marginBottom:8},children:[(0,e.jsx)("h4",{style:{margin:"0 0 16 0",fontSize:16},children:"\u6821\u9A8C\u89C4\u5219\u914D\u7F6E\uFF08Rule\uFF09"}),(0,e.jsxs)("div",{children:[c.map(function(l,a){return(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr auto",gap:16,marginBottom:16,padding:16,border:"1px solid #f0f0f0",borderRadius:4},children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#666"},children:"\u6821\u9A8C\u7C7B\u578B"}),(0,e.jsx)(se.Z,{value:l.type,onChange:function(h){return p(a,"type",h)},style:{width:"100%"},children:Me.map(function(i){return(0,e.jsx)(Te,{value:i.value,children:i.label},i.value)})})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#666"},children:"\u9519\u8BEF\u63D0\u793A"}),(0,e.jsx)(N.Z,{value:l.message||"",onChange:function(h){return p(a,"message",h.target.value)},placeholder:"\u5982\uFF1A\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7"})]}),(0,e.jsx)(w.ZP,{danger:!0,icon:(0,e.jsx)(r.Z,{}),onClick:function(){return H(a)}}),(l.type==="string"||l.type==="number")&&(0,e.jsxs)("div",{style:{gridColumn:"span 4",display:"flex",gap:16,marginTop:16},children:[(0,e.jsxs)("div",{style:{flex:1},children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#666"},children:l.type==="string"?"\u6700\u5C0F\u957F\u5EA6":"\u6700\u5C0F\u503C"}),(0,e.jsx)(xe.Z,{value:l.min,onChange:function(h){return p(a,"min",h)},style:{width:"100%"},placeholder:"\u53EF\u9009"})]}),(0,e.jsxs)("div",{style:{flex:1},children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:4,fontSize:12,color:"#666"},children:l.type==="string"?"\u6700\u5927\u957F\u5EA6":"\u6700\u5927\u503C"}),(0,e.jsx)(xe.Z,{value:l.max,onChange:function(h){return p(a,"max",h)},style:{width:"100%"},placeholder:"\u53EF\u9009"})]})]})]},a)}),(0,e.jsx)(w.ZP,{type:"dashed",icon:(0,e.jsx)(ie.Z,{}),onClick:ce,style:{width:"100%"},children:"\u6DFB\u52A0\u6821\u9A8C\u89C4\u5219"})]})]})]})})},_e=t(48115),$e=t(80882),ye=t(99611),Xe=t(48689),Re=t(66309),Le=t(98081),ke=t(86738),qe=t(61182),Ve=function(v){var d=v.fields,L=v.editField,R=v.editFieldHelm,K=v.removeField,V=v.changeOrder,S=(0,u.useState)([]),z=F()(S,2),Z=z[0],X=z[1];(0,u.useEffect)(function(){d&&X(M()(d).sort(function(b,T){return b.order-T.order}))},[d]);var Y=function(T,y){var c=M()(Z);V(c[T].name,T,c[y].name,y)},O=[{title:"\u5B57\u6BB5\u540D",dataIndex:"name",key:"name"},{title:"\u6807\u7B7E",dataIndex:"label",key:"label"},{title:"\u7C7B\u578B",dataIndex:"type",key:"type",render:function(T){var y=Ie.find(function(c){return c.value===T});return y?y.label:T}},{title:"\u5FC5\u586B",key:"required",render:function(T,y){var c=y.form_item_props.required||y.rules.some(function(D){return D.required});return c?(0,e.jsx)(Re.Z,{color:"red",children:"\u662F"}):(0,e.jsx)(Re.Z,{color:"gray",children:"\u5426"})}},{title:"\u987A\u5E8F\u8C03\u6574",key:"sort",width:120,render:function(T,y,c){return(0,e.jsxs)(Le.Z,{size:"small",children:[(0,e.jsx)(w.ZP,{type:"text",icon:(0,e.jsx)(_e.Z,{}),size:"small",disabled:c===0,onClick:function(){return Y(c,c-1)},"aria-label":"\u4E0A\u79FB"}),(0,e.jsx)(w.ZP,{type:"text",icon:(0,e.jsx)($e.Z,{}),size:"small",disabled:c===Z.length-1,onClick:function(){return Y(c,c+1)},"aria-label":"\u4E0B\u79FB"})]})}},{title:"\u64CD\u4F5C",key:"action",render:function(T,y){return(0,e.jsxs)(Le.Z,{size:"middle",children:[(0,e.jsx)(w.ZP,{type:"text",icon:(0,e.jsx)(ye.Z,{}),onClick:function(){return L(y)},children:"\u7F16\u8F91"}),(0,e.jsx)(w.ZP,{type:"text",icon:(0,e.jsx)(ye.Z,{}),onClick:function(){return R(y)},children:"\u5173\u8054helm\u914D\u7F6E"}),(0,e.jsx)(ke.Z,{title:"\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u5B57\u6BB5\u5417\uFF1F",onConfirm:function(){return K(y)},okText:"\u662F",cancelText:"\u5426",children:(0,e.jsx)(w.ZP,{type:"text",danger:!0,icon:(0,e.jsx)(Xe.Z,{}),children:"\u5220\u9664"})})]})}}];return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(qe.Z,{dataSource:Z,columns:O,rowKey:"name",pagination:!1,style:{marginBottom:24}})})},et=t(52677),He=t.n(et),tt=t(14873);function Ue(ae){for(var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",d=[],L=0,R=Object.entries(ae);L<R.length;L++){var K=F()(R[L],2),V=K[0],S=K[1],z=v?"".concat(v,".").concat(V):V;if(He()(S)==="object"&&S!==null&&!Array.isArray(S))d=d.concat(Ue(S,z));else{var Z=S==null?"":typeof S=="boolean"||typeof S=="number"?String(S):S;d.push([z,Z])}}return d}function nt(ae){try{var v=(0,tt.Qc)(ae);if(He()(v)!=="object"||v===null)throw new Error("YAML \u89E3\u6790\u7ED3\u679C\u4E0D\u662F\u6709\u6548\u5BF9\u8C61");return Ue(v)}catch(d){throw console.error("YAML \u8F6C\u6362 Properties \u5931\u8D25\uFF1A",d),d}}var at=t(25593),rt=t(78045),lt=at.Z.Title,it=function(v){var d=v.visible,L=v.init_field,R=v.chartName,K=v.onCancel,V=v.onSave,S=j.Z.useForm(),z=F()(S,1),Z=z[0],X=(0,u.useState)(),Y=F()(X,2),O=Y[0],b=Y[1],T=(0,u.useState)(),y=F()(T,2),c=y[0],D=y[1],he=(0,u.useState)(),k=F()(he,2),f=k[0],Q=k[1],ve=[{label:"boolean",value:"boolean"},{label:"string",value:"string"},{label:"number",value:"number"}],oe=function(){var H=te()(U()().mark(function p(){var m,G,l,a,i,h,g=arguments;return U()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return m=g.length>0&&g[0]!==void 0?g[0]:1,G=g.length>1&&g[1]!==void 0?g[1]:100,_.next=4,ne.Z.ArtifactsController.get_artifacts("charts",encodeURIComponent(encodeURIComponent(R)),"",G,m);case 4:l=_.sent,a=l.code,i=l.data,a==200&&(h=i.filter(function(B){var q,J;return(B==null||(q=B.extra_attrs)===null||q===void 0?void 0:q.appVersion)&&(B==null||(J=B.extra_attrs)===null||J===void 0?void 0:J.version)&&(B==null?void 0:B.digest)}).map(function(B){return{label:"".concat(B.extra_attrs.version,"(").concat(B.extra_attrs.appVersion,")"),value:B.digest}}),h.length>0&&(D(h),b(h[0].value)));case 8:case"end":return _.stop()}},p)}));return function(){return H.apply(this,arguments)}}(),de=function(){var H=te()(U()().mark(function p(){var m,G,l,a,i,h,g=arguments;return U()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return m=g.length>0&&g[0]!==void 0?g[0]:1,G=g.length>1&&g[1]!==void 0?g[1]:100,_.next=4,ne.Z.ArtifactsController.chart_values("charts",encodeURIComponent(encodeURIComponent(R)),O||"");case 4:l=_.sent,a=l.code,i=l.data,a==200&&(h=nt(i),Q(h.map(function(B){var q=F()(B,2),J=q[0],re=q[1];return{label:re&&re!=""?"".concat(J,"(\u9ED8\u8BA4\u503C:").concat(re,")"):J,value:J}})));case 8:case"end":return _.stop()}},p)}));return function(){return H.apply(this,arguments)}}();(0,u.useEffect)(function(){O&&de()},[O]),(0,u.useEffect)(function(){R&&oe()},[R]),(0,u.useEffect)(function(){Z.setFieldsValue(L.helm_props||{type:"string",keys:[],unit:""})},[L]);var ce=function(){Z.validateFields().then(function(p){var m=n()(n()({},L),{},{helm_props:p});V(m),K()}).catch(function(p){console.error("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25:",p),W.ZP.error("\u8BF7\u5B8C\u5584\u5FC5\u586B\u9879\u914D\u7F6E")})};return(0,e.jsx)(Oe.Z,{title:(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,e.jsx)(lt,{level:5,style:{margin:0},children:"\u5173\u8054helm\u914D\u7F6E"}),(0,e.jsx)(se.Z,{showSearch:!0,placeholder:"\u8BF7\u9009\u62E9\u5173\u8054chart\u7248\u672C",style:{width:200},onChange:function(p){return b(p)},value:O,filterOption:function(p,m){return(m==null?void 0:m.label.toLowerCase().includes(p.toLowerCase()))||!1},options:c})]}),closable:!1,open:d,onCancel:K,onOk:ce,destroyOnHidden:!1,afterClose:function(){Z.resetFields()},width:800,children:(0,e.jsxs)(j.Z,{form:Z,layout:"vertical",style:{marginTop:16},children:[(0,e.jsx)(j.Z.Item,{name:"keys",label:"\u8BBE\u7F6E\u5173\u8054helm\u914D\u7F6E",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5173\u8054helm\u914D\u7F6E"}],children:(0,e.jsx)(se.Z,{mode:"tags",showSearch:!0,placeholder:"\u8BF7\u9009\u62E9/\u8F93\u5165\u5173\u8054helm\u914D\u7F6E",style:{width:"100%"},filterOption:function(p,m){return(m==null?void 0:m.label.toLowerCase().includes(p.toLowerCase()))||!1},tagRender:function(p){return(0,e.jsx)(Re.Z,{color:"cyan",closable:p.closable,onClose:p.onClose,children:p.label})},options:f})}),(0,e.jsx)(j.Z.Item,{name:"type",label:"\u5B57\u6BB5\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5B57\u6BB5\u7C7B\u578B"}],children:(0,e.jsx)(rt.ZP.Group,{options:ve})}),(0,e.jsx)(j.Z.Item,{name:"unit",label:"\u5355\u4F4D",children:(0,e.jsx)(N.Z,{placeholder:"\u4F8B\u5982\uFF1AGi / m / % \uFF08\u975E\u5FC5\u586B\uFF09",style:{width:"100%"}})})]})})},ut=function(){var v=(0,Ce.useParams)(),d=v.app_id,L=(0,u.useState)(!1),R=F()(L,2),K=R[0],V=R[1],S=(0,u.useState)(!1),z=F()(S,2),Z=z[0],X=z[1],Y=j.Z.useForm(),O=F()(Y,1),b=O[0],T=(0,u.useState)(!1),y=F()(T,2),c=y[0],D=y[1],he=(0,u.useState)([]),k=F()(he,2),f=k[0],Q=k[1],ve=(0,u.useState)(""),oe=F()(ve,2),de=oe[0],ce=oe[1],H=(0,u.useState)({name:"",category:[],description:"",helm_chart:"",app_field_configs:[]}),p=F()(H,2),m=p[0],G=p[1],l=(0,u.useState)("basic"),a=F()(l,2),i=a[0],h=a[1],g=(0,u.useState)((0,$.get_init_field_config)()),je=F()(g,2),_=je[0],B=je[1],q=(0,u.useState)(""),J=F()(q,2),re=J[0],ot=J[1],dt=function(){var C=te()(U()().mark(function s(){var o,E,x;return U()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,ne.Z.AppsController.get_app_by_id(d);case 2:o=P.sent,E=o.code,x=o.data,E==200?(ce(x.helm_chart),G(x),b.setFieldsValue(x)):(W.ZP.error("\u83B7\u53D6\u5E94\u7528\u4FE1\u606F\u5931\u8D25"),Ce.history.push("/apps/config"));case 6:case"end":return P.stop()}},s)}));return function(){return C.apply(this,arguments)}}(),ct=function(){var C=te()(U()().mark(function s(){var o,E,x;return U()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return D(!0),P.next=3,ne.Z.ArtifactsController.get_repositories("charts",re?"name".concat(encodeURIComponent("="),"~").concat(re):"",10,1);case 3:o=P.sent,E=o.code,x=o.data,E==200&&Q(x||[]),D(!1);case 8:case"end":return P.stop()}},s)}));return function(){return C.apply(this,arguments)}}();(0,u.useEffect)(function(){ct()},[re]),(0,u.useEffect)(function(){d&&dt()},[d]);var We=function(s){var o=M()(m.app_field_configs||[]),E=o.findIndex(function(x){return x.field_id==s.field_id});o.splice(E,1),G(function(x){return n()(n()({},x),{},{app_field_configs:o})})},ze=function(s){B(s),V(!0)},Ke=function(s){B(s),X(!0)},Ge=function(s,o,E,x){var A=M()(m.app_field_configs||[]),P=A.findIndex(function(ee){return ee.name==s});P!==-1&&(A[P]=n()(n()({},A[P]),{},{order:x}));var le=A.findIndex(function(ee){return ee.name==E});le!==-1&&(A[le]=n()(n()({},A[le]),{},{order:o})),G(function(ee){return n()(n()({},ee),{},{app_field_configs:A})})},Ne=function(s){var o=M()(m.app_field_configs||[]),E=o.findIndex(function(A){return A.name==s.name});if(E!==-1)o[E]=n()(n()({},s),{},{config_type:o[E].config_type,field_id:o[E].field_id});else{var x=m.app_field_configs.filter(function(A){return A.config_type==i});o.push(n()(n()({},s),{},{config_type:i,order:x.length}))}G(function(A){return n()(n()({},A),{},{app_field_configs:o})})},ft=function(){var C=te()(U()().mark(function s(){var o,E,x,A,P,le,ee,Ye;return U()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,b.validateFields();case 2:if(o=I.sent,D(!0),I.prev=4,m.app_field_configs.length!=0){I.next=8;break}return W.ZP.error("\u8BF7\u8865\u5145\u96C6\u7FA4\u914D\u7F6E\u3001\u73AF\u5883\u53D8\u91CF\u914D\u7F6E!"),I.abrupt("return");case 8:if(E=n()(n()({},m),{},{name:o.name,description:o.description,category:o.category,helm_chart:o.helm_chart}),!d){I.next=18;break}return I.next=12,ne.Z.AppsController.update(E);case 12:x=I.sent,A=x.code,P=x.message,A==200?W.ZP.success("\u4FDD\u5B58\u914D\u7F6E\u6210\u529F"):W.ZP.error("\u4FDD\u5B58\u914D\u7F6E\u5931\u8D25"),I.next=24;break;case 18:return I.next=20,ne.Z.AppsController.add(E);case 20:le=I.sent,ee=le.code,Ye=le.message,ee==200?(W.ZP.success("\u5E94\u7528\u6CE8\u518C\u6210\u529F"),Ce.history.push("/apps/config")):W.ZP.error(Ye);case 24:return I.prev=24,D(!1),I.finish(24);case 27:case"end":return I.stop()}},s,null,[[4,,24,27]])}));return function(){return C.apply(this,arguments)}}(),pt=[{name:"name",label:"name",type:"text",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5E94\u7528\u670D\u52A1\u540D\u79F0"}],config_type:"",extra:"\u5E94\u7528\u670D\u52A1\u7684\u540D\u79F0",order:1,initial_value:"",form_item_props:{required:!0},field_props:{placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u670D\u52A1\u540D\u79F0",allowClear:!1}},{name:"description",label:"\u5E94\u7528\u63CF\u8FF0",type:"textarea",config_type:"",extra:"",order:2,initial_value:"",form_item_props:{},rules:[],field_props:{placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u63CF\u8FF0",allowClear:!0}},{name:"category",label:"\u5E94\u7528\u5206\u7C7B",type:"select",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5E94\u7528\u5206\u7C7B"}],config_type:"",extra:"\u5E94\u7528\u5206\u7C7B\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7\u8F93\u5165\u81EA\u5B9A\u4E49\u5206\u7C7B\u4FE1\u606F",order:3,initial_value:[],form_item_props:{required:!0},field_props:{placeholder:"\u8BF7\u9009\u62E9\u5E94\u7528\u5206\u7C7B",allowClear:!0,mode:"tags",options:[{label:"Web\u5E94\u7528",value:"Web\u5E94\u7528"},{label:"\u6570\u636E\u5E93",value:"\u6570\u636E\u5E93"},{label:"\u4E2D\u95F4\u4EF6",value:"\u4E2D\u95F4\u4EF6"},{label:"\u5DE5\u5177",value:"\u5DE5\u5177"},{label:"\u5176\u4ED6",value:"\u5176\u4ED6"}]}},{name:"helm_chart",label:"Helm\u6A21\u677F",type:"select",rules:[{required:!0,message:"\u8BF7\u9009\u62E9Helm\u6A21\u677F"}],config_type:"",extra:"\u8BBE\u7F6E\u5173\u8054helm chart\u6A21\u677F\uFF0C\u7528\u4E8E\u5E94\u7528\u90E8\u7F72\u65F6\u4F7F\u7528\u3002",order:3,initial_value:"",form_item_props:{required:!0},field_props:{placeholder:"\u8BF7\u9009\u62E9Helm\u6A21\u677F",allowClear:!0,options:f.map(function(C){return{label:C.name.replace("charts/",""),value:C.name.replace("charts/","")}}),showSearch:!0,onSearch:function(s){return ot(s)},onChange:function(s){return ce(s)}}}];return(0,e.jsxs)(Ae._z,{loading:c,children:[(0,e.jsx)(De.Z,{children:(0,e.jsxs)(j.Z,{layout:"vertical",children:[(0,e.jsxs)(ue.Z,{activeKey:i,onChange:function(s){(s=="basic"||s=="cluster"||s=="env")&&h(s)},children:[(0,e.jsx)(ue.Z.TabPane,{tab:"\u57FA\u7840\u4FE1\u606F",children:(0,e.jsx)(pe.Z,{form:b,fields:pt,labelCol:{span:4},wrapperCol:{span:14}})},"basic"),(0,e.jsxs)(ue.Z.TabPane,{tab:"\u96C6\u7FA4\u914D\u7F6E",children:[(0,e.jsx)("div",{style:{marginBottom:16,display:"flex",justifyContent:"flex-end"},children:(0,e.jsx)(w.ZP,{type:"dashed",icon:(0,e.jsx)(ie.Z,{}),onClick:function(){return V(!0)},children:"\u6DFB\u52A0\u914D\u7F6E\u9879"})}),(0,e.jsx)(Ve,{fields:m.app_field_configs.filter(function(C){return C.config_type=="cluster"}),editField:ze,removeField:We,editFieldHelm:Ke,changeOrder:Ge})]},"cluster"),(0,e.jsxs)(ue.Z.TabPane,{tab:"\u73AF\u5883\u53D8\u91CF",children:[(0,e.jsx)("div",{style:{marginBottom:16,display:"flex",justifyContent:"flex-end"},children:(0,e.jsx)(w.ZP,{type:"dashed",icon:(0,e.jsx)(ie.Z,{}),onClick:function(){return V(!0)},children:"\u6DFB\u52A0\u73AF\u5883\u53D8\u91CF"})}),(0,e.jsx)(Ve,{fields:m.app_field_configs.filter(function(C){return C.config_type=="env"}),editField:ze,removeField:We,editFieldHelm:Ke,changeOrder:Ge})]},"env")]}),(0,e.jsx)("div",{style:{marginTop:24,textAlign:"right"},children:(0,e.jsx)(w.ZP,{type:"primary",icon:(0,e.jsx)(Be.Z,{}),onClick:ft,loading:c,children:d==null?"\u6CE8\u518C\u5E94\u7528":"\u4FDD\u5B58\u914D\u7F6E"})})]})}),(0,e.jsx)(we,{init_field:_,visible:K,nameValidator:function(s,o){if(m.app_field_configs.length>0){var E=m.app_field_configs.filter(function(x){return x.config_type==i}).map(function(x){return x.name||""});if(o&&E.includes(o))return Promise.reject(new Error("\u5B57\u6BB5\u540D\u4E0D\u80FD\u4E3A ".concat(o,"\uFF0C\u8BF7\u66F4\u6362\u5176\u4ED6\u540D\u79F0")))}return Promise.resolve("")},onCancel:function(){V(!1)},onSave:Ne}),(0,e.jsx)(it,{visible:Z,init_field:_,chartName:de,onCancel:function(){return X(!1)},onSave:Ne})]})},st=ut},65136:function(Qe,ge,t){var be=t(97857),n=t.n(be),Ee=t(13769),M=t.n(Ee),fe=t(25278),U=t(13457),Ze=t(34041),te=t(78045),Se=t(72269),F=t(86587),ne=t(67294),$=t(85893),ie=["form","fields"],Be=["placeholder","prefix","allowClear","showCount","min","max","step","options","selectMode","uploadAction","accept","variant","checkboxOptions"],Ae=function(j){var W=j.form,De=j.fields,ue=M()(j,ie),w=function(pe){if(pe!=null){var Pe=pe.type,me=pe.field_props,r=me===void 0?{}:me;switch(Pe){case"text":return(0,$.jsx)(fe.Z,n()({placeholder:r.placeholder,allowClear:r.allowClear,prefix:r.prefix,variant:r.variant},r));case"password":return(0,$.jsx)(fe.Z.Password,n()({placeholder:r.placeholder,allowClear:r.allowClear,variant:r.variant},r));case"textarea":return(0,$.jsx)(fe.Z.TextArea,n()({placeholder:r.placeholder,allowClear:r.allowClear,showCount:r.showCount,variant:r.variant,rows:4},n()(n()({},r),{},{prefix:void 0})));case"number":return(0,$.jsx)(U.Z,n()({placeholder:r.placeholder,min:r.min,max:r.max,step:r.step,style:{width:"100%"},variant:r.variant},r));case"select":return(0,$.jsx)(Ze.Z,n()({placeholder:r.placeholder,allowClear:r.allowClear,mode:r.mode,options:r.options},r));case"radio":return(0,$.jsx)(te.ZP.Group,n()({options:r.options,disabled:r.disabled},r));case"switch":var se=r.placeholder,Oe=r.prefix,N=r.allowClear,Fe=r.showCount,xe=r.min,e=r.max,Te=r.step,Ie=r.options,Me=r.selectMode,Je=r.uploadAction,we=r.accept,_e=r.variant,$e=r.checkboxOptions,ye=M()(r,Be);return(0,$.jsx)(Se.Z,n()({},ye));default:return null}}};return(0,$.jsx)(F.Z,n()(n()({form:W,layout:"horizontal"},ue),{},{children:De.map(function(u){return(0,$.jsx)(F.Z.Item,n()(n()({name:u.name,label:u.label,rules:u.rules,extra:u.extra,initialValue:u.initial_value},u.form_item_props),{},{children:w(u)}),u.field_id)})}))};ge.Z=Ae}}]);
